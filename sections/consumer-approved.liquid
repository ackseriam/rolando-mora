<style>
  .consumer-approved {
    background-color: {{ section.settings.background_color }};
    padding: 3rem 0;
    text-align: center;
    overflow: hidden;
  }
 
  @media (min-width: 990px) {
    .consumer-approved {
      padding: 6rem 0; /* Increased padding matches lg:py-6xl */
    }
  }
 
  .consumer-approved__container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }
 
  .consumer-approved__heading {
    font-family: 'Playfair Display', Georgia, 'Times New Roman', serif;
    font-weight: 400;
    font-style: italic;
    font-size: 1.8rem; /* Mobile matching font-2xl */
    line-height: 1.2;
    margin: 0;
    color: {{ section.settings.heading_color }};
  }
 
  @media (min-width: 990px) {
    .consumer-approved__heading {
      font-size: 64px; /* Desktop matching font-5xl */
    }
  }
 
  .consumer-approved__cards {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    margin-top: 2rem;
    position: relative;
  }
 
  /* Desktop Layout */
  @media (min-width: 990px) {
    .consumer-approved__cards {
      flex-direction: row;
      justify-content: center;
      gap: 0; /* Gap handled by JS/Transform for fan effect */
      margin-top: 5rem;
      height: 400px; /* Ensure height for fanned cards */
      align-items: center;
    }
  }
 
  .consumer-approved__card {
    background-color: {{ section.settings.card_color }};
    border-radius: 12px; /* br-md */
    padding: 2.5rem 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    max-width: 320px;
    min-height: 240px;
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05); /* Subtle shadow for depth */
    will-change: transform, opacity;
  }
 
  @media (min-width: 990px) {
    .consumer-approved__card {
      /* Absolute positioning or specific margins might be needed if pure transform isn't enough, 
         but flex center + transform works for the fan effect if container has height. 
         Actually, the user's script uses transforms from a centered position. */
      flex: 0 0 300px; /* Fixed width for fanned cards */
      max-width: none;
      padding: 3rem 2rem;
      opacity: 0; /* Initial state for JS animation */
    }
  }
  .consumer-approved__card {
      opacity: 0;
      transform: translateY(30px);
      transition: transform 2.7s cubic-bezier(0.33, 1, 0.68, 1),
                  opacity 0.7s cubic-bezier(0.33, 1, 0.68, 1);
    }
  /* Mobile Animation: CSS transition fade-in */
  @media (max-width: 989px) {
    .consumer-approved__card {
      opacity: 0;
      transform: translateY(30px);
      transition: transform 5.7s cubic-bezier(0.33, 1, 0.68, 1),
                  opacity 0.7s cubic-bezier(0.33, 1, 0.68, 1);
    }
 
    .consumer-approved__card--delay-1 { transition-delay: 0.1s; }
    .consumer-approved__card--delay-2 { transition-delay: 0.2s; }
 
    .consumer-approved__cards.is-visible .consumer-approved__card {
      opacity: 1;
      transform: translateY(0);
    }
  }
 
  .consumer-approved__number {
    font-family: 'Playfair Display', Georgia, 'Times New Roman', serif;
    font-weight: 400;
    font-style: italic;
    font-size: 3.5rem;
    line-height: 1;
    margin-bottom: 0.75rem;
    color: {{ section.settings.number_color }};
    display: block;
  }
 
  @media (min-width: 990px) {
    .consumer-approved__number {
      font-size: 4.5rem; /* font-7xl */
    }
  }
 
  .consumer-approved__description {
    font-family: 'Montserrat', sans-serif;
    font-weight: 600; /* weight-600 */
    font-size: 1rem;
    line-height: 1.2;
    margin: 0;
    color: {{ section.settings.text_color }};
    max-width: 240px;
  }
 
  .consumer-approved__disclaimer {
    margin-top: 2.5rem;
    font-size: 0.8rem;
    color: {{ section.settings.disclaimer_color }};
    font-family: 'Montserrat', sans-serif;
    font-weight: 400;
    font-style: italic;
  }
 
  @media (min-width: 990px) {
    .consumer-approved__disclaimer {
      margin-top: 1.5rem;
    }
  }
</style>
 
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;1,400&family=Montserrat:wght@400;600;700&display=swap">
 
<section class="consumer-approved" data-section-id="{{ section.id }}">
  <div class="consumer-approved__container">
    <h2 class="consumer-approved__heading">{{ section.settings.heading }}</h2>
 
    <div class="consumer-approved__cards" id="consumer-approved-cards-{{ section.id }}">
      <div class="consumer-approved__card consumer-approved__card--0">
        <span class="consumer-approved__number">{{ section.settings.card_1_percentage }}</span>
        <p class="consumer-approved__description">{{ section.settings.card_1_description }}</p>
      </div>
 
      <div class="consumer-approved__card consumer-approved__card--1 consumer-approved__card--delay-1">
        <span class="consumer-approved__number">{{ section.settings.card_2_percentage }}</span>
        <p class="consumer-approved__description">{{ section.settings.card_2_description }}</p>
      </div>
 
      <div class="consumer-approved__card consumer-approved__card--2 consumer-approved__card--delay-2">
        <p class="consumer-approved__description">{{ section.settings.card_3_description }}</p>
      </div>
    </div>
 
    <p class="consumer-approved__disclaimer">{{ section.settings.disclaimer }}</p>
  </div>        <span class="consumer-approved__number">{{ section.settings.card_3_percentage }}</span>

</section>
 
<script>
  (function () {
    var sectionId = '{{ section.id }}';
    var section = document.querySelector('[data-section-id="' + sectionId + '"]');
    var cardsContainer = document.getElementById('consumer-approved-cards-' + sectionId);
 
    if (!section || !cardsContainer) return;
 
    var cards = cardsContainer.querySelectorAll('.consumer-approved__card');
    var numberElements = cardsContainer.querySelectorAll('.consumer-approved__number'); // Get numbers
    var isDesktop = window.matchMedia('(min-width: 990px)');
 
    /* Card Animation Data */
    var cardData = [
      { start: { x: 40, rotate: -2, y: 10 }, end: { x: -80, rotate: -5.03, y: 0 } },
      { start: { x: 0, rotate: 0, y: 0 }, end: { x: 0, rotate: 0.698, y: 0 } },
      { start: { x: -40, rotate: 2, y: 10 }, end: { x: 80, rotate: 5, y: 0 } }
    ];
 
    function easeOutCubic(t) { return 1 - Math.pow(1 - t, 3); }
 
    /* 
       ESTA FUNCION HACE EL CONTEO (0 -> %)
       It converts "100%" to 100, animates 0->100, then adds "%" back.
    */
    function animateCounters() {
      numberElements.forEach(function(el) {
        if (el.dataset.animated) return; // Run once only
        
        var originalText = el.innerText.trim();
        // Regex to split number from suffix (e.g., "97%" -> "97", "%")
        var match = originalText.match(/(\d+)(.*)/); 
        if (!match) return; // If no number found, skip
 
        var targetVal = parseInt(match[1], 10);
        var suffix = match[2] || '';
        var duration = 4000; // 2 seconds
        var startTime = null;
 
        el.dataset.animated = "true";
 
        function step(timestamp) {
          if (!startTime) startTime = timestamp;
          var progress = Math.min((timestamp - startTime) / duration, 1);
          var ease = easeOutCubic(progress);
          
          var currentVal = Math.floor(ease * targetVal);
          el.innerText = currentVal + suffix;
 
          if (progress < 1) {
            window.requestAnimationFrame(step);
          } else {
            el.innerText = originalText; // Final value exact
          }
        }
        window.requestAnimationFrame(step);
      });
    }
 
    /* Scroll Logic */
    function getScrollProgress() {
      var rect = section.getBoundingClientRect();
      var viewH = window.innerHeight;
      var start = viewH * 0.85; 
      var end = viewH * 0.25;
      
      var raw = (start - rect.top) / (start - end);
      return Math.max(0, Math.min(1, raw));
    }
 
    function updateAnimations() {
      var rawProgress = getScrollProgress();
      
      // Trigger numbers early (when section just enters)
      if (rawProgress > 0.05 || !isDesktop.matches) {
          animateCounters();
      }
 
      if (!isDesktop.matches) return;
 
      var p = easeOutCubic(rawProgress);
 
      for (var i = 0; i < cards.length; i++) {
        var data = cardData[i];
        var currentX = data.start.x + (data.end.x - data.start.x) * p;
        var currentRot = data.start.rotate + (data.end.rotate - data.start.rotate) * p;
        var currentY = data.start.y + (data.end.y - data.start.y) * p;
        var opacity = 0.5 + (0.5 * p);
 
        cards[i].style.transform = `translateX(${currentX}px) translateY(${currentY}px) rotate(${currentRot}deg)`;
        cards[i].style.opacity = opacity;
        cards[i].style.zIndex = (i === 1) ? 2 : 1;
      }
    }
 
    /* Mobile Setup */
    function initMobile() {
      if ('IntersectionObserver' in window) {
        var observer = new IntersectionObserver(function (entries) {
            entries.forEach(function (entry) {
              if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                animateCounters(); 
                observer.unobserve(entry.target);
              }
            });
          }, { threshold: 0.15 });
        observer.observe(cardsContainer);
      } else {
        cardsContainer.classList.add('is-visible');
        animateCounters();
      }
    }
 
    var ticking = false;
    function onScroll() {
      if (!ticking) {
        ticking = true;
        requestAnimationFrame(function () {
            updateAnimations();
            ticking = false;
        });
      }
    }
 
    function init() {
      if (isDesktop.matches) {
        // Reset manual style just in case of resize
        cards.forEach(c => c.style.transition = 'none'); 
        updateAnimations();
        window.addEventListener('scroll', onScroll, { passive: true });
        window.addEventListener('resize', onScroll);
      } else {
        initMobile();
      }
    }
 
    // Handle Resize/Breakpoint Support
    isDesktop.addEventListener('change', function () {
      if (isDesktop.matches) {
        cardsContainer.classList.remove('is-visible');
        updateAnimations();
        window.addEventListener('scroll', onScroll, { passive: true });
      } else {
        window.removeEventListener('scroll', onScroll);
        // Clean desktop styles
        cards.forEach(c => { 
            c.style.transform = ''; 
            c.style.opacity = ''; 
            c.style.zIndex = '';
        });
        initMobile();
      }
    });
 
    requestAnimationFrame(init);
  })();
</script>
 
{% schema %}
{
  "name": "Consumer Approved",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Consumer Approved"
    },
    {
      "type": "header",
      "content": "Card 1"
    },
    {
      "type": "text",
      "id": "card_1_percentage",
      "label": "Percentage",
      "default": "100%"
    },
    {
      "type": "textarea",
      "id": "card_1_description",
      "label": "Description",
      "default": "Said their skin looked more supple"
    },
    {
      "type": "header",
      "content": "Card 2"
    },
    {
      "type": "text",
      "id": "card_2_percentage",
      "label": "Percentage",
      "default": "97%"
    },
    {
      "type": "textarea",
      "id": "card_2_description",
      "label": "Description",
      "default": "Said their skin appeared firmer"
    },
    {
      "type": "header",
      "content": "Card 3"
    },
    {
      "type": "text",
      "id": "card_3_percentage",
      "label": "Percentage",
      "default": "97%"
    },
    {
      "type": "textarea",
      "id": "card_3_description",
      "label": "Description",
      "default": "Said their crepey skin looked more even and smooth"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "textarea",
      "id": "disclaimer",
      "label": "Disclaimer Text",
      "default": "*Based on consumer perception questionnaire of 32 subjects after 4 weeks"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Section Background",
      "default": "#F3F0FF"
    },
    {
      "type": "color",
      "id": "card_color",
      "label": "Card Background",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#4834d4"
    },
    {
      "type": "color",
      "id": "number_color",
      "label": "Number Color",
      "default": "#4834d4"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Description Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "disclaimer_color",
      "label": "Disclaimer Color",
      "default": "#666666"
    }
  ],
  "presets": [
    {
      "name": "Consumer Approved"
    }
  ]
}
{% endschema %}